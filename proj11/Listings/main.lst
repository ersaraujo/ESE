C51 COMPILER V9.60.0.0   MAIN                                                              05/09/2022 15:00:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REG517A.H>
   2          
   3          #define ROW_SIZE        4
   4          #define COL_SIZE        3
   5          #define CORRECAO        0
   6          #define BOUCING_TIME    4
   7          
   8          #define FREQ_TIMER      100
   9          #define FREQ_CLK        12000000
  10          
  11          #define TH0_INICIAL ((65536-(FREQ_CLK/(12*FREQ_TIMER)) + CORRECAO)>>8)
  12          #define TL0_INICIAL ((65536-(FREQ_CLK/(12*FREQ_TIMER)) + CORRECAO)&0xFF)
  13          
  14          bit  teclado_TeclaApertada = 0;
  15          
  16          static unsigned char timerBoucing = 0;
  17          
  18          typedef enum{
  19            INIT,
  20            CHECKBIT,
  21            BOUCING,
  22            RESET,
  23          }estados;
  24          
  25          const char row_value[ROW_SIZE] = {0x0E, 0x0D, 0x0B, 0x7};
  26          unsigned char stable[ROW_SIZE][COL_SIZE];
  27          unsigned char unstable[ROW_SIZE][COL_SIZE];
  28          
  29          const char keys[ROW_SIZE][COL_SIZE] = {
  30            {'1','2','3'},
  31            {'4','5','6'},
  32            {'7','8','9'},
  33            {'*','0','#'}
  34          };
  35          
  36          void timerInit(){
  37   1        TR0 = 0;                              
  38   1        TMOD = (TMOD & 0xF0)|0x01;
  39   1        TH0 = TH0_INICIAL;          
  40   1        TL0 = TL0_INICIAL;
  41   1        ET0 = 1; 
  42   1        TR0 = 1;            
  43   1      }
  44          
  45          void initializeSerial(){
  46   1        S0RELH = 0x03;
  47   1        S0RELL = 0xD9;
  48   1        BD = 1;
  49   1        S0CON |= 0x50;
  50   1        TMOD  = (TMOD&0x0F) | 0x20;
  51   1        ES0 = 1;  
  52   1      }
  53          
  54          void timerInterruption (void) interrupt 1 using 2{
C51 COMPILER V9.60.0.0   MAIN                                                              05/09/2022 15:00:57 PAGE 2   

  55   1        TR0 = 0;                                
  56   1        TL0 += TL0_INICIAL;
  57   1        TH0 += TH0_INICIAL + (unsigned char) CY;
  58   1        TR0 = 1;                                                      
  59   1        timerBoucing++;                     
  60   1      }
  61          
  62          void verificaTecla(int i){
  63   1        static estados stateFunction;
  64   1        
  65   1        switch(stateFunction){
  66   2          case BOUCING:                         
  67   2            if(timerBoucing < BOUCING_TIME){
  68   3              stateFunction = BOUCING;
  69   3            }
  70   2            stateFunction = CHECKBIT;
  71   2            timerBoucing = 0;
  72   2            break;
  73   2          case CHECKBIT:
  74   2            if(P5^i){
  75   3              teclado_TeclaApertada = 1;
  76   3            }else{
  77   3              teclado_TeclaApertada = 0;
  78   3            }
  79   2            stateFunction = RESET;
  80   2            break;
  81   2          default:    
  82   2            stateFunction = BOUCING;          
  83   2            break;
  84   2        }
  85   1      }
  86          
  87          void scan(){
  88   1        int i, j;
  89   1        P5 |= 0x0F;
  90   1        for(i = 0; i < ROW_SIZE; ++i){
  91   2          P5 |= row_value[i-1];
  92   2          for(j = 0; j < COL_SIZE; ++j){
  93   3            if(P5^(j+4) == 1){
  94   4              verificaTecla(j+4);     
  95   4              if(teclado_TeclaApertada){
  96   5                stable[i-1][j-1] = 1;
  97   5              }else{
  98   5                stable[i-1][j-1] = 0;
  99   5              }
 100   4            }
 101   3            teclado_TeclaApertada = 0;
 102   3          }
 103   2        }
 104   1      }
 105          
 106          void printSerial(){
 107   1        int i, j;
 108   1        for(i = 0; i < ROW_SIZE; i++){
 109   2          for(j = 0; j < COL_SIZE; j++){
 110   3            if(stable[i][j]){
 111   4              S0BUF = keys[i-1][j-1];
 112   4              while(!TI0);
 113   4              TI0 = 0;
 114   4            }
 115   3          }
 116   2        } 
C51 COMPILER V9.60.0.0   MAIN                                                              05/09/2022 15:00:57 PAGE 3   

 117   1      }
 118          
 119          int main(){
 120   1        timerInit();
 121   1        initializeSerial();
 122   1        EAL = 1;
 123   1        while(1){
 124   2          scan();
 125   2          printSerial();
 126   2        }
 127   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    284    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     42    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
